/**
 * @copyright  (C) 2024 Open Source Matters, Inc. <https://www.joomla.org>
 * @license    GNU General Public License version 2 or later; see LICENSE.txt
 */function getText(s,e){var t;const i=typeof((t=Joomla)==null||(t=t.Text)==null?void 0:t._)=="function"?Joomla.Text._(s):"";return i!==s?i:e}const texts={none:["JNONE","None"],close:["JCLOSE","Close"]},checker='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAIAAAACUFjqAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3ggRDQENU0dyawAAACZJREFUGNNjPHXqDAMSMDY2ROYyMeAFNJVm/Pv3LzL/7Nnzg8VpAKebCGpIIxHBAAAAAElFTkSuQmCC")',template=Object.assign(document.createElement("template"),{innerHTML:`
    <button type="button" part="opener" aria-expanded="false"></button>
    <div part="panel">
      <slot name="colors"></slot>
      <button type="button" aria-label="Close" part="close">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" width="16" height="16" fill="currentColor"><path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/></svg>
      </button>
    </div>`}),sheet=new CSSStyleSheet;sheet.replaceSync("[part=close] svg { padding-block-start: .2rem; }");function getColorName(s){let e=s;if(e==="none")return getText(texts.none[0],texts.none[1]);if(s.startsWith("#")&&s.length===4){const t=s.split("");e=t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]}return e}class JoomlaFieldSimpleColor extends HTMLElement{get value(){return this.getAttribute("value")}set value(e){this.setAttribute("value",e)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(template.content.cloneNode(!0)),this.shadowRoot.adoptedStyleSheets=[sheet],this.internals=null,this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.keys=this.keys.bind(this),this.colorSelect=this.colorSelect.bind(this),this.getActiveElement=this.getActiveElement.bind(this),this.onDocumentClick=this.onDocumentClick.bind(this),this.div=document.createElement("div")}connectedCallback(){try{this.internals=this.attachInternals(),this.form=this.internals.form}catch{throw new Error("Unsupported browser")}if(this.internals){var e;(e=this.querySelector("input[type=hidden]"))==null||e.remove()}this.internals&&this.internals.labels.length&&this.internals.labels.forEach(t=>t.addEventListener("click",this.show)),this.button=this.shadowRoot.querySelector("[part=opener]"),this.panel=this.shadowRoot.querySelector("[part=panel]"),this.closeButton=this.panel.querySelector("[part=close]"),this.panel.style.display="none",this.button.style.background=this.value==="none"?checker:this.value,this.button.addEventListener("click",this.show),this.internals.setFormValue(this.value)}show(){let e;this.slotted=this.shadowRoot.querySelector("slot[name=colors]"),this.addEventListener("keydown",this.keys),this.closeButton.addEventListener("click",this.hide),this.closeButton.setAttribute("aria-label",getText(texts.close[0],texts.close[1])),this.slotted.assignedElements().forEach(t=>{this.validateColor(t.value)||t.remove(),t.style.background=t.value==="none"?checker:t.value,t.setAttribute("aria-label",getColorName(t.value)),t.addEventListener("click",this.colorSelect),t.getAttribute("aria-pressed")==="true"&&(e=t)}),this.button.style.display="none",this.panel.style.display="flex",this.button.setAttribute("aria-expanded","true"),e?e.focus():this.closeButton.focus(),document.addEventListener("click",this.onDocumentClick)}hide(){this.removeEventListener("keydown",this.keys),document.removeEventListener("click",this.onDocumentClick),this.button.setAttribute("aria-expanded","false"),this.panel.style.display="none",this.button.style.display="block",this.slotted.assignedElements().forEach(e=>e.removeEventListener("click",this.colorSelect)),this.button.focus()}onDocumentClick(e){[...this.internals.labels].includes(e.target)||e.target.closest("joomla-field-simple-color")!==this&&this.panel.style.display==="flex"&&this.hide()}colorSelect(e){const{currentTarget:t}=e;this.slotted.assignedElements().forEach(i=>i.setAttribute("aria-pressed",i!==t?"false":"true")),this.button.style.background=t.value==="none"?checker:t.value,this.hide(),this.internals.setFormValue(t.value),this.value=t.value,this.dispatchEvent(new Event("change"))}keys(e){if(e.code==="Escape"&&this.hide(),e.code==="Tab"){const t=[...this.slotted.assignedElements(),this.closeButton],i=t.indexOf(this.getActiveElement());e.shiftKey&&i===0?(t[t.length-1].focus(),e.preventDefault()):!e.shiftKey&&i===t.length-1&&(t[0].focus(),e.preventDefault())}}getActiveElement(e=document){const t=e.activeElement;return t?t.shadowRoot?this.getActiveElement(t.shadowRoot):t:null}validateColor(e){return this.div.style.color=e,this.div.style.color!==""}}JoomlaFieldSimpleColor.formAssociated=!0,customElements.define("joomla-field-simple-color",JoomlaFieldSimpleColor);
