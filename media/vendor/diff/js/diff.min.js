(function(m,P){typeof exports=="object"&&typeof module<"u"?P(exports):typeof define=="function"&&define.amd?define(["exports"],P):(m=typeof globalThis<"u"?globalThis:m||self,P(m.Diff={}))})(this,(function(m){"use strict";class P{diff(e,t,i={}){let r;typeof i=="function"?(r=i,i={}):"callback"in i&&(r=i.callback);const l=this.castInput(e,i),s=this.castInput(t,i),f=this.removeEmpty(this.tokenize(l,i)),u=this.removeEmpty(this.tokenize(s,i));return this.diffWithOptionsObj(f,u,i,r)}diffWithOptionsObj(e,t,i,r){var l;const s=a=>{if(a=this.postProcess(a,i),r){setTimeout(function(){r(a)},0);return}else return a},f=t.length,u=e.length;let w=1,c=f+u;i.maxEditLength!=null&&(c=Math.min(c,i.maxEditLength));const h=(l=i.timeout)!==null&&l!==void 0?l:1/0,W=Date.now()+h,y=[{oldPos:-1,lastComponent:void 0}];let d=this.extractCommon(y[0],t,e,0,i);if(y[0].oldPos+1>=u&&d+1>=f)return s(this.buildValues(y[0].lastComponent,t,e));let g=-1/0,p=1/0;const O=()=>{for(let a=Math.max(g,-w);a<=Math.min(p,w);a+=2){let o;const v=y[a-1],C=y[a+1];v&&(y[a-1]=void 0);let L=!1;if(C){const E=C.oldPos-a;L=C&&0<=E&&E<f}const D=v&&v.oldPos+1<u;if(!L&&!D){y[a]=void 0;continue}if(!D||L&&v.oldPos<C.oldPos?o=this.addToPath(C,!0,!1,0,i):o=this.addToPath(v,!1,!0,1,i),d=this.extractCommon(o,t,e,a,i),o.oldPos+1>=u&&d+1>=f)return s(this.buildValues(o.lastComponent,t,e))||!0;y[a]=o,o.oldPos+1>=u&&(p=Math.min(p,a-1)),d+1>=f&&(g=Math.max(g,a+1))}w++};if(r)(function a(){setTimeout(function(){if(w>c||Date.now()>W)return r(void 0);O()||a()},0)})();else for(;w<=c&&Date.now()<=W;){const a=O();if(a)return a}}addToPath(e,t,i,r,l){const s=e.lastComponent;return s&&!l.oneChangePerToken&&s.added===t&&s.removed===i?{oldPos:e.oldPos+r,lastComponent:{count:s.count+1,added:t,removed:i,previousComponent:s.previousComponent}}:{oldPos:e.oldPos+r,lastComponent:{count:1,added:t,removed:i,previousComponent:s}}}extractCommon(e,t,i,r,l){const s=t.length,f=i.length;let u=e.oldPos,w=u-r,c=0;for(;w+1<s&&u+1<f&&this.equals(i[u+1],t[w+1],l);)w++,u++,c++,l.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return c&&!l.oneChangePerToken&&(e.lastComponent={count:c,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=u,w}equals(e,t,i){return i.comparator?i.comparator(e,t):e===t||!!i.ignoreCase&&e.toLowerCase()===t.toLowerCase()}removeEmpty(e){const t=[];for(let i=0;i<e.length;i++)e[i]&&t.push(e[i]);return t}castInput(e,t){return e}tokenize(e,t){return Array.from(e)}join(e){return e.join("")}postProcess(e,t){return e}get useLongestToken(){return!1}buildValues(e,t,i){const r=[];let l;for(;e;)r.push(e),l=e.previousComponent,delete e.previousComponent,e=l;r.reverse();const s=r.length;let f=0,u=0,w=0;for(;f<s;f++){const c=r[f];if(c.removed)c.value=this.join(i.slice(w,w+c.count)),w+=c.count;else{if(!c.added&&this.useLongestToken){let h=t.slice(u,u+c.count);h=h.map(function(W,y){const d=i[w+y];return d.length>W.length?d:W}),c.value=this.join(h)}else c.value=this.join(t.slice(u,u+c.count));u+=c.count,c.added||(w+=c.count)}}return r}}class le extends P{}const J=new le;function se(n,e,t){return J.diff(n,e,t)}function R(n,e){let t;for(t=0;t<n.length&&t<e.length;t++)if(n[t]!=e[t])return n.slice(0,t);return n.slice(0,t)}function q(n,e){let t;if(!n||!e||n[n.length-1]!=e[e.length-1])return"";for(t=0;t<n.length&&t<e.length;t++)if(n[n.length-(t+1)]!=e[e.length-(t+1)])return n.slice(-t);return n.slice(-t)}function b(n,e,t){if(n.slice(0,e.length)!=e)throw Error(`string ${JSON.stringify(n)} doesn't start with prefix ${JSON.stringify(e)}; this is a bug`);return t+n.slice(e.length)}function z(n,e,t){if(!e)return n+t;if(n.slice(-e.length)!=e)throw Error(`string ${JSON.stringify(n)} doesn't end with suffix ${JSON.stringify(e)}; this is a bug`);return n.slice(0,-e.length)+t}function k(n,e){return b(n,e,"")}function F(n,e){return z(n,e,"")}function _(n,e){return e.slice(0,fe(n,e))}function fe(n,e){let t=0;n.length>e.length&&(t=n.length-e.length);let i=e.length;n.length<e.length&&(i=n.length);const r=Array(i);let l=0;r[0]=0;for(let s=1;s<i;s++){for(e[s]==e[l]?r[s]=r[l]:r[s]=l;l>0&&e[s]!=e[l];)l=r[l];e[s]==e[l]&&l++}l=0;for(let s=t;s<n.length;s++){for(;l>0&&n[s]!=e[l];)l=r[l];n[s]==e[l]&&l++}return l}function ue(n){return n.includes(`\r
`)&&!n.startsWith(`
`)&&!n.match(/[^\r]\n/)}function oe(n){return!n.includes(`\r
`)&&n.includes(`
`)}function x(n){let e;for(e=n.length-1;e>=0&&n[e].match(/\s/);e--);return n.substring(e+1)}function S(n){const e=n.match(/^\s*/);return e?e[0]:""}const A="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",ae=new RegExp(`[${A}]+|\\s+|[^${A}]`,"ug");class ce extends P{equals(e,t,i){return i.ignoreCase&&(e=e.toLowerCase(),t=t.toLowerCase()),e.trim()===t.trim()}tokenize(e,t={}){let i;if(t.intlSegmenter){const s=t.intlSegmenter;if(s.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');i=Array.from(s.segment(e),f=>f.segment)}else i=e.match(ae)||[];const r=[];let l=null;return i.forEach(s=>{/\s/.test(s)?l==null?r.push(s):r.push(r.pop()+s):l!=null&&/\s/.test(l)?r[r.length-1]==l?r.push(r.pop()+s):r.push(l+s):r.push(s),l=s}),r}join(e){return e.map((t,i)=>i==0?t:t.replace(/^\s+/,"")).join("")}postProcess(e,t){if(!e||t.oneChangePerToken)return e;let i=null,r=null,l=null;return e.forEach(s=>{s.added?r=s:s.removed?l=s:((r||l)&&V(i,l,r,s),i=s,r=null,l=null)}),(r||l)&&V(i,l,r,null),e}}const U=new ce;function de(n,e,t){return t?.ignoreWhitespace!=null&&!t.ignoreWhitespace?B(n,e,t):U.diff(n,e,t)}function V(n,e,t,i){if(e&&t){const r=S(e.value),l=x(e.value),s=S(t.value),f=x(t.value);if(n){const u=R(r,s);n.value=z(n.value,s,u),e.value=k(e.value,u),t.value=k(t.value,u)}if(i){const u=q(l,f);i.value=b(i.value,f,u),e.value=F(e.value,u),t.value=F(t.value,u)}}else if(t){if(n){const r=S(t.value);t.value=t.value.substring(r.length)}if(i){const r=S(i.value);i.value=i.value.substring(r.length)}}else if(n&&i){const r=S(i.value),l=S(e.value),s=x(e.value),f=R(r,l);e.value=k(e.value,f);const u=q(k(r,f),s);e.value=F(e.value,u),i.value=b(i.value,r,u),n.value=z(n.value,r,r.slice(0,r.length-u.length))}else if(i){const r=S(i.value),l=x(e.value),s=_(l,r);e.value=F(e.value,s)}else if(n){const r=x(n.value),l=S(e.value),s=_(r,l);e.value=k(e.value,s)}}class he extends P{tokenize(e){const t=new RegExp(`(\\r?\\n)|[${A}]+|[^\\S\\n\\r]+|[^${A}]`,"ug");return e.match(t)||[]}}const X=new he;function B(n,e,t){return X.diff(n,e,t)}function ge(n,e){if(typeof n=="function")e.callback=n;else if(n)for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e}class me extends P{constructor(){super(...arguments),this.tokenize=Z}equals(e,t,i){return i.ignoreWhitespace?((!i.newlineIsToken||!e.includes(`
`))&&(e=e.trim()),(!i.newlineIsToken||!t.includes(`
`))&&(t=t.trim())):i.ignoreNewlineAtEof&&!i.newlineIsToken&&(e.endsWith(`
`)&&(e=e.slice(0,-1)),t.endsWith(`
`)&&(t=t.slice(0,-1))),super.equals(e,t,i)}}const j=new me;function H(n,e,t){return j.diff(n,e,t)}function we(n,e,t){return t=ge(t,{ignoreWhitespace:!0}),j.diff(n,e,t)}function Z(n,e){e.stripTrailingCr&&(n=n.replace(/\r\n/g,`
`));const t=[],i=n.split(/(\n|\r\n)/);i[i.length-1]||i.pop();for(let r=0;r<i.length;r++){const l=i[r];r%2&&!e.newlineIsToken?t[t.length-1]+=l:t.push(l)}return t}function ve(n){return n=="."||n=="!"||n=="?"}class ye extends P{tokenize(e){var t;const i=[];let r=0;for(let l=0;l<e.length;l++){if(l==e.length-1){i.push(e.slice(r));break}if(ve(e[l])&&e[l+1].match(/\s/)){for(i.push(e.slice(r,l+1)),l=r=l+1;!((t=e[l+1])===null||t===void 0)&&t.match(/\s/);)l++;i.push(e.slice(r,l+1)),r=l+1}}return i}}const G=new ye;function pe(n,e,t){return G.diff(n,e,t)}class We extends P{tokenize(e){return e.split(/([{}:;,]|\s+)/)}}const Q=new We;function Ce(n,e,t){return Q.diff(n,e,t)}class Oe extends P{constructor(){super(...arguments),this.tokenize=Z}get useLongestToken(){return!0}castInput(e,t){const{undefinedReplacement:i,stringifyReplacer:r=(l,s)=>typeof s>"u"?i:s}=t;return typeof e=="string"?e:JSON.stringify(T(e,null,null,r),null,"  ")}equals(e,t,i){return super.equals(e.replace(/,([\r\n])/g,"$1"),t.replace(/,([\r\n])/g,"$1"),i)}}const Y=new Oe;function Pe(n,e,t){return Y.diff(n,e,t)}function T(n,e,t,i,r){e=e||[],t=t||[],i&&(n=i(r===void 0?"":r,n));let l;for(l=0;l<e.length;l+=1)if(e[l]===n)return t[l];let s;if(Object.prototype.toString.call(n)==="[object Array]"){for(e.push(n),s=new Array(n.length),t.push(s),l=0;l<n.length;l+=1)s[l]=T(n[l],e,t,i,String(l));return e.pop(),t.pop(),s}if(n&&n.toJSON&&(n=n.toJSON()),typeof n=="object"&&n!==null){e.push(n),s={},t.push(s);const f=[];let u;for(u in n)Object.prototype.hasOwnProperty.call(n,u)&&f.push(u);for(f.sort(),l=0;l<f.length;l+=1)u=f[l],s[u]=T(n[u],e,t,i,u);e.pop(),t.pop()}else s=n;return s}class De extends P{tokenize(e){return e.slice()}join(e){return e}removeEmpty(e){return e}}const K=new De;function Le(n,e,t){return K.diff(n,e,t)}function ee(n){return Array.isArray(n)?n.map(e=>ee(e)):Object.assign(Object.assign({},n),{hunks:n.hunks.map(e=>Object.assign(Object.assign({},e),{lines:e.lines.map((t,i)=>{var r;return t.startsWith("\\")||t.endsWith("\r")||!((r=e.lines[i+1])===null||r===void 0)&&r.startsWith("\\")?t:t+"\r"})}))})}function ne(n){return Array.isArray(n)?n.map(e=>ne(e)):Object.assign(Object.assign({},n),{hunks:n.hunks.map(e=>Object.assign(Object.assign({},e),{lines:e.lines.map(t=>t.endsWith("\r")?t.substring(0,t.length-1):t)}))})}function Se(n){return Array.isArray(n)||(n=[n]),!n.some(e=>e.hunks.some(t=>t.lines.some(i=>!i.startsWith("\\")&&i.endsWith("\r"))))}function Ee(n){return Array.isArray(n)||(n=[n]),n.some(e=>e.hunks.some(t=>t.lines.some(i=>i.endsWith("\r"))))&&n.every(e=>e.hunks.every(t=>t.lines.every((i,r)=>{var l;return i.startsWith("\\")||i.endsWith("\r")||((l=t.lines[r+1])===null||l===void 0?void 0:l.startsWith("\\"))})))}function I(n){const e=n.split(/\n/),t=[];let i=0;function r(){const f={};for(t.push(f);i<e.length;){const u=e[i];if(/^(---|\+\+\+|@@)\s/.test(u))break;const w=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(u);w&&(f.index=w[1]),i++}for(l(f),l(f),f.hunks=[];i<e.length;){const u=e[i];if(/^(Index:\s|diff\s|---\s|\+\+\+\s|===================================================================)/.test(u))break;if(/^@@/.test(u))f.hunks.push(s());else{if(u)throw new Error("Unknown line "+(i+1)+" "+JSON.stringify(u));i++}}}function l(f){const u=/^(---|\+\+\+)\s+(.*)\r?$/.exec(e[i]);if(u){const w=u[2].split("	",2),c=(w[1]||"").trim();let h=w[0].replace(/\\\\/g,"\\");/^".*"$/.test(h)&&(h=h.substr(1,h.length-2)),u[1]==="---"?(f.oldFileName=h,f.oldHeader=c):(f.newFileName=h,f.newHeader=c),i++}}function s(){var f;const u=i,w=e[i++],c=w.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),h={oldStart:+c[1],oldLines:typeof c[2]>"u"?1:+c[2],newStart:+c[3],newLines:typeof c[4]>"u"?1:+c[4],lines:[]};h.oldLines===0&&(h.oldStart+=1),h.newLines===0&&(h.newStart+=1);let W=0,y=0;for(;i<e.length&&(y<h.oldLines||W<h.newLines||!((f=e[i])===null||f===void 0)&&f.startsWith("\\"));i++){const d=e[i].length==0&&i!=e.length-1?" ":e[i][0];if(d==="+"||d==="-"||d===" "||d==="\\")h.lines.push(e[i]),d==="+"?W++:d==="-"?y++:d===" "&&(W++,y++);else throw new Error(`Hunk at line ${u+1} contained invalid line ${e[i]}`)}if(!W&&h.newLines===1&&(h.newLines=0),!y&&h.oldLines===1&&(h.oldLines=0),W!==h.newLines)throw new Error("Added line count did not match for hunk at line "+(u+1));if(y!==h.oldLines)throw new Error("Removed line count did not match for hunk at line "+(u+1));return h}for(;i<e.length;)r();return t}function ke(n,e,t){let i=!0,r=!1,l=!1,s=1;return function f(){if(i&&!l){if(r?s++:i=!1,n+s<=t)return n+s;l=!0}if(!r)return l||(i=!0),e<=n-s?n-s++:(r=!0,f())}}function te(n,e,t={}){let i;if(typeof e=="string"?i=I(e):Array.isArray(e)?i=e:i=[e],i.length>1)throw new Error("applyPatch only works with a single input.");return xe(n,i[0],t)}function xe(n,e,t={}){(t.autoConvertLineEndings||t.autoConvertLineEndings==null)&&(ue(n)&&Se(e)?e=ee(e):oe(n)&&Ee(e)&&(e=ne(e)));const i=n.split(`
`),r=e.hunks,l=t.compareLine||((d,g,p,O)=>g===O),s=t.fuzzFactor||0;let f=0;if(s<0||!Number.isInteger(s))throw new Error("fuzzFactor must be a non-negative integer");if(!r.length)return n;let u="",w=!1,c=!1;for(let d=0;d<r[r.length-1].lines.length;d++){const g=r[r.length-1].lines[d];g[0]=="\\"&&(u[0]=="+"?w=!0:u[0]=="-"&&(c=!0)),u=g}if(w){if(c){if(!s&&i[i.length-1]=="")return!1}else if(i[i.length-1]=="")i.pop();else if(!s)return!1}else if(c){if(i[i.length-1]!="")i.push("");else if(!s)return!1}function h(d,g,p,O=0,a=!0,o=[],v=0){let C=0,L=!1;for(;O<d.length;O++){const D=d[O],E=D.length>0?D[0]:" ",M=D.length>0?D.substr(1):D;if(E==="-")if(l(g+1,i[g],E,M))g++,C=0;else return!p||i[g]==null?null:(o[v]=i[g],h(d,g+1,p-1,O,!1,o,v+1));if(E==="+"){if(!a)return null;o[v]=M,v++,C=0,L=!0}if(E===" ")if(C++,o[v]=i[g],l(g+1,i[g],E,M))v++,a=!0,L=!1,g++;else return L||!p?null:i[g]&&(h(d,g+1,p-1,O+1,!1,o,v+1)||h(d,g+1,p-1,O,!1,o,v+1))||h(d,g,p-1,O+1,!1,o,v)}return v-=C,g-=C,o.length=v,{patchedLines:o,oldLineLastI:g-1}}const W=[];let y=0;for(let d=0;d<r.length;d++){const g=r[d];let p;const O=i.length-g.oldLines+s;let a;for(let o=0;o<=s;o++){a=g.oldStart+y-1;const v=ke(a,f,O);for(;a!==void 0&&(p=h(g.lines,a,o),!p);a=v());if(p)break}if(!p)return!1;for(let o=f;o<a;o++)W.push(i[o]);for(let o=0;o<p.patchedLines.length;o++){const v=p.patchedLines[o];W.push(v)}f=p.oldLineLastI+1,y=a+1-g.oldStart}for(let d=f;d<i.length;d++)W.push(i[d]);return W.join(`
`)}function Fe(n,e){const t=typeof n=="string"?I(n):n;let i=0;function r(){const l=t[i++];if(!l)return e.complete();e.loadFile(l,function(s,f){if(s)return e.complete(s);const u=te(f,l,e);e.patched(l,u,function(w){if(w)return e.complete(w);r()})})}r()}function ie(n){return Array.isArray(n)?n.map(e=>ie(e)).reverse():Object.assign(Object.assign({},n),{oldFileName:n.newFileName,oldHeader:n.newHeader,newFileName:n.oldFileName,newHeader:n.oldHeader,hunks:n.hunks.map(e=>({oldLines:e.newLines,oldStart:e.newStart,newLines:e.oldLines,newStart:e.oldStart,lines:e.lines.map(t=>t.startsWith("-")?`+${t.slice(1)}`:t.startsWith("+")?`-${t.slice(1)}`:t)}))})}function $(n,e,t,i,r,l,s){let f;s?typeof s=="function"?f={callback:s}:f=s:f={},typeof f.context>"u"&&(f.context=4);const u=f.context;if(f.newlineIsToken)throw new Error("newlineIsToken may not be used with patch-generation functions, only with diffing functions");if(f.callback){const{callback:c}=f;H(t,i,Object.assign(Object.assign({},f),{callback:h=>{const W=w(h);c(W)}}))}else return w(H(t,i,f));function w(c){if(!c)return;c.push({value:"",lines:[]});function h(a){return a.map(function(o){return" "+o})}const W=[];let y=0,d=0,g=[],p=1,O=1;for(let a=0;a<c.length;a++){const o=c[a],v=o.lines||Te(o.value);if(o.lines=v,o.added||o.removed){if(!y){const C=c[a-1];y=p,d=O,C&&(g=u>0?h(C.lines.slice(-u)):[],y-=g.length,d-=g.length)}for(const C of v)g.push((o.added?"+":"-")+C);o.added?O+=v.length:p+=v.length}else{if(y)if(v.length<=u*2&&a<c.length-2)for(const C of h(v))g.push(C);else{const C=Math.min(v.length,u);for(const D of h(v.slice(0,C)))g.push(D);const L={oldStart:y,oldLines:p-y+C,newStart:d,newLines:O-d+C,lines:g};W.push(L),y=0,d=0,g=[]}p+=v.length,O+=v.length}}for(const a of W)for(let o=0;o<a.lines.length;o++)a.lines[o].endsWith(`
`)?a.lines[o]=a.lines[o].slice(0,-1):(a.lines.splice(o+1,0,"\\ No newline at end of file"),o++);return{oldFileName:n,newFileName:e,oldHeader:r,newHeader:l,hunks:W}}}function N(n){if(Array.isArray(n))return n.map(N).join(`
`);const e=[];n.oldFileName==n.newFileName&&e.push("Index: "+n.oldFileName),e.push("==================================================================="),e.push("--- "+n.oldFileName+(typeof n.oldHeader>"u"?"":"	"+n.oldHeader)),e.push("+++ "+n.newFileName+(typeof n.newHeader>"u"?"":"	"+n.newHeader));for(let t=0;t<n.hunks.length;t++){const i=n.hunks[t];i.oldLines===0&&(i.oldStart-=1),i.newLines===0&&(i.newStart-=1),e.push("@@ -"+i.oldStart+","+i.oldLines+" +"+i.newStart+","+i.newLines+" @@");for(const r of i.lines)e.push(r)}return e.join(`
`)+`
`}function re(n,e,t,i,r,l,s){if(typeof s=="function"&&(s={callback:s}),s?.callback){const{callback:f}=s;$(n,e,t,i,r,l,Object.assign(Object.assign({},s),{callback:u=>{f(u?N(u):void 0)}}))}else{const f=$(n,e,t,i,r,l,s);return f?N(f):void 0}}function Ae(n,e,t,i,r,l){return re(n,n,e,t,i,r,l)}function Te(n){const e=n.endsWith(`
`),t=n.split(`
`).map(i=>i+`
`);return e?t.pop():t.push(t.pop().slice(0,-1)),t}function Ne(n){const e=[];let t,i;for(let r=0;r<n.length;r++)t=n[r],t.added?i=1:t.removed?i=-1:i=0,e.push([i,t.value]);return e}function be(n){const e=[];for(let t=0;t<n.length;t++){const i=n[t];i.added?e.push("<ins>"):i.removed&&e.push("<del>"),e.push(ze(i.value)),i.added?e.push("</ins>"):i.removed&&e.push("</del>")}return e.join("")}function ze(n){let e=n;return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e}m.Diff=P,m.applyPatch=te,m.applyPatches=Fe,m.arrayDiff=K,m.canonicalize=T,m.characterDiff=J,m.convertChangesToDMP=Ne,m.convertChangesToXML=be,m.createPatch=Ae,m.createTwoFilesPatch=re,m.cssDiff=Q,m.diffArrays=Le,m.diffChars=se,m.diffCss=Ce,m.diffJson=Pe,m.diffLines=H,m.diffSentences=pe,m.diffTrimmedLines=we,m.diffWords=de,m.diffWordsWithSpace=B,m.formatPatch=N,m.jsonDiff=Y,m.lineDiff=j,m.parsePatch=I,m.reversePatch=ie,m.sentenceDiff=G,m.structuredPatch=$,m.wordDiff=U,m.wordsWithSpaceDiff=X}));
