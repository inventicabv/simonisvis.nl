(function(t){var s=PhpDebugBar.utils.makecsscls("phpdebugbar-widgets-"),c=PhpDebugBar.Widgets.SQLQueriesWidget=PhpDebugBar.Widget.extend({className:s("sqlqueries"),onFilterClick:function(d){t(d).toggleClass(s("excluded")),this.$list.$el.find("li[connection="+t(d).attr("rel")+"]").toggle()},onCopyToClipboard:function(d){var o=t(d).parent("li").find("code").get(0),n=function(){try{document.execCommand("copy")&&(t(d).addClass(s("copy-clipboard-check")),setTimeout(function(){t(d).removeClass(s("copy-clipboard-check"))},2e3))}catch{console.log("Oops, unable to copy")}},e=function(l){if(document.selection){var a=document.body.createTextRange();a.moveToElementText(l),a.select()}else if(window.getSelection){var a=document.createRange();a.selectNodeContents(l),window.getSelection().removeAllRanges(),window.getSelection().addRange(a)}n(),window.getSelection().removeAllRanges()};e(o)},renderList:function(d,o,n){var e=t("<ul />").addClass(s("table-list")),l,a=t("<li />").addClass(s("table-list-item")),i=t("<span />").addClass("phpdebugbar-text-muted");for(var p in n){var r=typeof n[p]=="function"?n[p].name+" {}":n[p];a.clone().append(typeof r=="object"&&r!==null?[i.clone().text(r.index||p).append("."),"&nbsp;"].concat(r.namespace?[r.namespace+"::"]:[]).concat([r.name||r.file]).concat(r.line?[i.clone().text(":"+r.line)]:[]):[i.clone().text(p+":"),"&nbsp;",i.clone().text(r).html()]).appendTo(e)}return d+=o?' <i class="phpdebugbar-fa phpdebugbar-fa-'+o+' phpdebugbar-text-muted"></i>':"",t("<tr />").append(t("<td />").addClass(s("name")).html(d),t("<td />").addClass(s("value")).append(e))},render:function(){this.$status=t("<div />").addClass(s("status")).appendTo(this.$el),this.$toolbar=t("<div />").addClass(s("toolbar")).appendTo(this.$el);var d=[],o=this;this.$list=new PhpDebugBar.Widgets.ListWidget({itemRenderer:function(n,e){if(e.slow&&n.addClass(s("sql-slow")),e.width_percent&&t("<div />").addClass(s("bg-measure")).append(t("<div />").addClass(s("value")).css({left:e.start_percent+"%",width:Math.max(e.width_percent,.01)+"%"})).appendTo(n),e.duration_str&&t('<span title="Duration" />').addClass(s("duration")).text(e.duration_str).appendTo(n),e.memory_str&&t('<span title="Memory usage" />').addClass(s("memory")).text(e.memory_str).appendTo(n),typeof e.row_count<"u"&&t('<span title="Row count" />').addClass(s("row-count")).text(e.row_count).appendTo(n),typeof e.stmt_id<"u"&&e.stmt_id&&t('<span title="Prepared statement ID" />').addClass(s("stmt-id")).text(e.stmt_id).appendTo(n),e.connection&&(t('<span title="Connection" />').addClass(s("database")).text(e.connection).appendTo(n),n.attr("connection",e.connection),t.inArray(e.connection,d)==-1&&(d.push(e.connection),t("<a />").addClass(s("filter")).text(e.connection).attr("rel",e.connection).on("click",function(){o.onFilterClick(this)}).appendTo(o.$toolbar),d.length>1&&(o.$toolbar.show(),o.$list.$el.css("margin-bottom","20px")))),(!e.type||e.type==="query")&&t('<span title="Copy to clipboard" />').addClass(s("copy-clipboard")).css("cursor","pointer").html("&#8203;").on("click",function(i){o.onCopyToClipboard(this),i.stopPropagation()}).appendTo(n),typeof e.xdebug_link<"u"&&e.xdebug_link){var l=t('<span title="Filename" />').addClass(s("filename")).text(e.xdebug_link.filename+(e.xdebug_link.line?"#"+e.xdebug_link.line:""));t('<a href="'+e.xdebug_link.url+'"></a>').on("click",function(){event.stopPropagation(),e.xdebug_link.ajax&&(fetch(e.xdebug_link.url),event.preventDefault())}).addClass(s("editor-link")).appendTo(l),l.appendTo(n)}e.type==="transaction"?t("<strong />").addClass(s("sql")).addClass(s("name")).text(e.sql).appendTo(n):t("<code />").addClass(s("sql")).html(PhpDebugBar.Widgets.highlight(e.sql,"sql")).appendTo(n),typeof e.is_success<"u"&&!e.is_success&&(n.addClass(s("error")),n.append(t("<span />").addClass(s("error")).text("["+e.error_code+"] "+e.error_message)));var a=t("<table></table>").addClass(s("params"));e.params&&!t.isEmptyObject(e.params)&&o.renderList("Params","thumb-tack",e.params).appendTo(a),e.bindings&&!t.isEmptyObject(e.bindings)&&o.renderList("Bindings","thumb-tack",e.bindings).appendTo(a),e.hints&&!t.isEmptyObject(e.hints)&&o.renderList("Hints","question-circle",e.hints).appendTo(a),e.backtrace&&!t.isEmptyObject(e.backtrace)&&o.renderList("Backtrace","list-ul",e.backtrace).appendTo(a),a.find("tr").length&&(a.appendTo(n),n.css("cursor","pointer").click(function(){if(window.getSelection().type=="Range")return"";a.is(":visible")?a.hide():a.show()}))}}),this.$list.$el.appendTo(this.$el),this.bindAttr("data",function(n){if(n.length<=0||!n.statements)return!1;d=[],this.$toolbar.hide().find(s(".filter")).remove(),this.$list.set("data",n.statements),this.$status.empty();for(var e={},l=0,a=0;a<n.statements.length;a++)if(!(n.statements[a].type&&n.statements[a].type!=="query")){var i=n.statements[a].sql;n.statements[a].params&&!t.isEmptyObject(n.statements[a].params)&&(i+=JSON.stringify(n.statements[a].params)),n.statements[a].bindings&&!t.isEmptyObject(n.statements[a].bindings)&&(i+=JSON.stringify(n.statements[a].bindings)),n.statements[a].connection&&(i+="@"+n.statements[a].connection),e[i]=e[i]||{keys:[]},e[i].keys.push(a)}for(var i in e)if(e[i].keys.length>1){l+=e[i].keys.length;for(var a=0;a<e[i].keys.length;a++)this.$list.$el.find("."+s("list-item")).eq(e[i].keys[a]).addClass(s("sql-duplicate"))}var p=t("<span />").text(n.nb_statements+" statements were executed").appendTo(this.$status);if(n.nb_failed_statements&&p.append(", "+n.nb_failed_statements+" of which failed"),l){p.append(", "+l+" of which were duplicates"),p.append(", "+(n.nb_statements-l)+" unique. ");var r="Show only duplicated";t("<a />").addClass(s("duplicates")).click(function(){t(this).toggleClass("shown-duplicated").text(t(this).hasClass("shown-duplicated")?"Show All":r),t("."+o.className+" ."+s("list-item")).not("."+s("sql-duplicate")).toggle()}).text(r).appendTo(p)}n.accumulated_duration_str&&this.$status.append(t('<span title="Accumulated duration" />').addClass(s("duration")).text(n.accumulated_duration_str)),n.memory_usage_str&&this.$status.append(t('<span title="Memory usage" />').addClass(s("memory")).text(n.memory_usage_str))})}})})(PhpDebugBar.$);
