document.addEventListener("alpine:init",()=>{Alpine.data("price_range",e=>{return{init(){this.$watch("lowerThumbDragStart",e=>{if(e){this.igniteDragging("lower")}else{this.takeOffDragging("lower")}});this.$watch("upperThumbDragStart",e=>{if(e){this.igniteDragging("upper")}else{this.takeOffDragging("upper")}});this.lowerThumbPercentValue=this.mapRange({value:e.min_value,valueMin:e.min,valueMax:e.max,toMin:0,toMax:100});this.upperThumbPercentValue=this.mapRange({value:e.max_value,valueMin:e.min,valueMax:e.max,toMin:0,toMax:100});this.minDistance=Math.max(this.minDistance,this.mapRange({value:e.distance,valueMin:e.min,valueMax:e.max,toMin:0,toMax:100}))},options:e,lowerThumbDragStart:false,upperThumbDragStart:false,tooltipVisible:{lower:false,upper:false},lowerThumbPercentValue:e.min_value,upperThumbPercentValue:100,minDistance:1,lowerValue:e.min_value,upperValue:e.max_value,minPriceError:"",maxPriceError:"",validatePrices(){this.minPriceError="";this.maxPriceError="";let e=false;const t=e=>e<=0||e<this.options.min||e>this.options.max;e=t(this.lowerValue)||t(this.upperValue);if(!e){if(this.lowerValue>this.upperValue){e=true}else if(this.lowerValue===this.upperValue){e=true}}if(e){this.lowerValue=this.options.min;this.upperValue=this.options.max;this.lowerThumbPercentValue=this.mapRange({value:this.lowerValue,valueMin:this.options.min,valueMax:this.options.max,toMin:0,toMax:100});this.upperThumbPercentValue=this.mapRange({value:this.upperValue,valueMin:this.options.min,valueMax:this.options.max,toMin:0,toMax:100});this.updateUrlSearchParams();return false}return true},startDrag(e){if(e==="lower"){this.lowerThumbDragStart=true}else if(e==="upper"){this.upperThumbDragStart=true}document.body.style.userSelect="none"},endDrag(e){if(e==="lower"){this.lowerThumbDragStart=false;if(this.lowerValue<this.options.min){this.lowerValue=this.options.min}}else if(e==="upper"){this.upperThumbDragStart=false}document.body.style.userSelect="auto";this.updateUrlSearchParams()},igniteDragging(e){window.addEventListener("mousemove",this.handleMouseMove.bind(this,e));window.addEventListener("mouseup",this.handleMouseEnd.bind(this,e));window.addEventListener("touchmove",this.handleMouseMove.bind(this,e));window.addEventListener("touchend",this.handleMouseEnd.bind(this,e))},takeOffDragging(e){window.removeEventListener("mousemove",this.handleMouseMove.bind(this,e));window.removeEventListener("mouseup",this.handleMouseEnd.bind(this,e));window.removeEventListener("touchmove",this.handleMouseMove.bind(this,e));window.removeEventListener("touchend",this.handleMouseEnd.bind(this,e))},handleMouseMove(e,t){if(e==="lower"&&!this.lowerThumbDragStart)return;if(e==="upper"&&!this.upperThumbDragStart)return;const i=t.touches?t.touches[0]?.clientX:t.clientX;if(e==="lower"){this.lowerThumbPercentValue=Math.min(this.upperThumbPercentValue-this.minDistance,this.getLeftPosition(i))}else if(e==="upper"){this.upperThumbPercentValue=Math.max(this.lowerThumbPercentValue+this.minDistance,this.getLeftPosition(i))}},handleMouseEnd(e){this.endDrag(e)},getLeftPosition(e){const t=this.$refs?.rangeSlider;if(!t)return 0;const i=t.getBoundingClientRect();const a=Math.floor(i.width);const r=Math.max(0,e-i.left);const n=Math.min(100,r*100/a);return Math.round(n)},updateUrlSearchParams(){const e=this.lowerThumbValue;const t=this.upperThumbValue;const i=new URLSearchParams(window.location.search);if(!this.validatePrices()){return}if(Number(i.get("filter_min_price"))!==e||Number(i.get("filter_max_price"))!==t){i.set("filter_min_price",e);i.set("filter_max_price",t);window.location.href=`${window.location.pathname}?${i.toString()}`}},updateValue(e,t){const i=Number(e.value);this.minPriceError="";this.maxPriceError="";if(isNaN(i)){if(t==="lower"){this.lowerValue=this.options.min;this.lowerThumbPercentValue=this.mapRange({value:this.lowerValue,valueMin:this.options.min,valueMax:this.options.max,toMin:0,toMax:100})}else{this.upperValue=this.options.max;this.upperThumbPercentValue=this.mapRange({value:this.upperValue,valueMin:this.options.min,valueMax:this.options.max,toMin:0,toMax:100})}return}if(t==="lower"){this.lowerValue=i;this.lowerThumbPercentValue=this.mapRange({value:i,valueMin:this.options.min,valueMax:this.options.max,toMin:0,toMax:100})}else if(t==="upper"){this.upperValue=i;this.upperThumbPercentValue=this.mapRange({value:i,valueMin:this.options.min,valueMax:this.options.max,toMin:0,toMax:100})}if(this.validatePrices()){this.updateUrlSearchParams()}},mapRange({value:e,valueMin:t,valueMax:i,toMin:a,toMax:r}){if(t===i){return a}const n=Math.min(Math.max(e,t),i);return Math.round((n-t)/(i-t)*(r-a)+a)},get lowerThumbValue(){if(!this.lowerThumbDragStart){return this.lowerValue}this.lowerValue=this.mapRange({value:this.lowerThumbPercentValue,valueMin:0,valueMax:100,toMin:this.options.min,toMax:this.options.max});return this.lowerValue},get upperThumbValue(){if(!this.upperThumbDragStart){return this.upperValue}this.upperValue=this.mapRange({value:this.upperThumbPercentValue,valueMin:0,valueMax:100,toMin:this.options.min,toMax:this.options.max});return this.upperValue},get sliderStyles(){const e=Math.max(0,this.lowerThumbPercentValue-11);const t=Math.min(94,this.upperThumbPercentValue+5);return{"--easystore-range-lower-bound":`${e}%`,"--easystore-range-upper-bound":`${t}%`}},showTooltip(e,t){this.tooltipVisible[e]=t}}})});