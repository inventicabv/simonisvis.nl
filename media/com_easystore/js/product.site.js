document.addEventListener("alpine:init",()=>{Alpine.data("easystore_product_review",i=>({data:{title:"",ratings:"",message:"",requiredValues:["title","ratings"]},submitReview(){const e=this.data.requiredValues.every(e=>`${this.data[e]}`.trim());if(!e)return;const t=new FormData;t.append("easystore-title",this.data.title);t.append("easystore-ratings",this.data.ratings);t.append("easystore-message",this.data.message);t.append("productId",i.productId);const s=`${Joomla.getOptions("easystore.base")}/index.php?option=com_easystore&task=product.addReview`;Joomla.request({url:s,method:"POST",data:t,onSuccess:e=>{e=JSON.parse(e);if(e.status==="success"){document.location.reload()}},onError:e=>{Joomla.renderMessages(Joomla.ajaxErrorsMessages(e))}})}}));Alpine.directive("log",(e,{expression:t},{evaluate:s})=>{console.log(s(t))});Alpine.data("easystore_invoice",()=>({easystorePrintInvoice(){window.print()}}));Alpine.data("easystoreProductDetailsThumbnail",()=>({lensVisible:false,init(){const e=this.$refs.productThumbnail;const s=this.$refs.lens;this.result=document.querySelector(".easystore-product-image-zoom-result");this.$nextTick(()=>{const t=document.querySelector(".easystore-product-image-zoom-result");if(!t){console.error("Result element is missing.");return}t.style.backgroundImage=`url(${e.src})`;s.style.display="none";t.style.display="none";this.$watch("lensVisible",e=>{s.style.display=e?"block":"none";t.style.display=e?"block":"none"})})},moveLens(e){this.lensVisible=true;const t=document.querySelector(".easystore-product-image-zoom-result");const s=this.$refs.lens;const i=this.$refs.productThumbnail;const n=i.getBoundingClientRect();const a=this.getCursorPos(e,i);const o=700;const r=100;const l=.9*window.innerWidth-n.right;const d=n.left;const c=.9*window.innerHeight;const h=i.width*.3;const u=h;const m=h;s.style.height=`${u}px`;s.style.width=`${m}px`;const p=Math.max(l,d);const y=Math.min(p/u,c/m);const g=Math.min(o,u*y);const f=m*y;if(l>n.left){t.style.left=`${i.width+n.left}px`;t.style.top=`${r}px`}else{t.style.right=`${i.width+l}px`;t.style.top=`${r}px`}t.style.width=`${g}px`;t.style.height=`${Math.min(f,c)}px`;let v=a.x-s.offsetWidth/2;let w=a.y-s.offsetHeight/2;if(v<0)v=0;if(w<0)w=0;if(v>i.width-s.offsetWidth)v=i.width-s.offsetWidth;if(w>i.height-s.offsetHeight)w=i.height-s.offsetHeight;if(l<=127.5&&n.left<=127.5){this.lensVisible=false}s.style.left=`${v}px`;s.style.top=`${w}px`;const S=t.offsetWidth/s.offsetWidth;const b=t.offsetHeight/s.offsetHeight;if(isNaN(S)||isNaN(b)){return}t.style.backgroundPosition=`-${v*S}px -${w*b}px`;t.style.backgroundSize=`${i.width*S}px ${i.height*b}px`},getCursorPos(e,t){const s=t.getBoundingClientRect();const i=e.clientX-s.left;const n=e.clientY-s.top;return{x:i,y:n}}}))});document.addEventListener("alpine:init",()=>{Alpine.data("easystoreProductDetails",()=>{return{init(){this.setInitialActiveSource();this.$watch("openPreview",e=>this.watchPreviewMode(e));this.$watch("zoomNextLevel",e=>this.watchNextLevelZooming(e));this.$watch("currentSelectedIndex",e=>this.watchSelectedImage(e));this.listenKeyboardEvent();this.controlVideoBasedOnDocumentVisibility()},getRef(e){const t=this.$refs[e]??document.querySelector(`[x-ref="${e}"]`);if(!t){return null}return t},quantity:1,openPreview:false,zoomNextLevel:false,currentSelectedIndex:0,activeSource:null,playState:false,activeMediaType:null,controlVideoBasedOnDocumentVisibility(){document.addEventListener("visibilitychange",()=>{const e=this.getRef("previewVideo");if(!e){return}if(document.visibilityState==="hidden"){this.pauseVideo(e)}if(document.visibilityState==="visible"){this.playVideo(e)}})},listenKeyboardEvent(){window.addEventListener("keydown",e=>{if(!this.openPreview){return}switch(e.key){case"Escape":this.openPreview=false;this.getRef("previewVideo").pause();break;case"ArrowLeft":this.currentSelectedIndex=this.currentSelectedIndex-1;if(this.currentSelectedIndex<0){this.currentSelectedIndex=this.totalImages-1}break;case"ArrowRight":this.currentSelectedIndex=this.currentSelectedIndex+1;if(this.currentSelectedIndex>=this.totalImages){this.currentSelectedIndex=0}break;case" ":{this.zoomNextLevel=!this.zoomNextLevel;if(this.activeMediaType!=="video"){return}this.playState=!this.playState;const t=this.getRef("previewVideo");if(this.playState){this.playVideo(t)}else{this.pauseVideo(t)}break}}})},toggleZoom(){this.zoomNextLevel=!this.zoomNextLevel},onThumbnailChange(e,t,s){let i=null;const n=this.getRef("productVideo");const a=this.getRef("productThumbnail");const o=document.querySelector(".easystore-product-image-zoom-result");if(s==="video"){i=n.querySelector("video");a.style.display="none";n.style.display="block"}else{i=a;n.style.display="none";a.style.display="block"}if(!i){return}this.activeSource=t;this.setCurrentSelectedIndex();i.src=t;if(o){o.style.backgroundImage=`url(${t})`}const r=e.currentTarget.parentNode;const l=r.querySelectorAll("button");l.forEach(e=>e.classList.remove("active"));e.currentTarget.classList.add("active")},increment(){this.quantity=Number(this.quantity)+1},decrement(){this.quantity=Math.max(1,Number(this.quantity)-1)},closeOpenedModalIfAny(){const e=document.querySelector("#easystore-modal");e.classList.remove("active");e.setAttribute("aria-hidden","true");e.setAttribute("aria-busy","false");document.body.classList.remove("easystore-modal-open")},addToCart(e,t){const s=new FormData;const i=[{product_id:e,sku_id:t||null,quantity:this.quantity}];const n=`${Joomla.getOptions("easystore.base")}/index.php?option=com_easystore&task=cart.addToCart`;s.append("items",JSON.stringify(i));s.append("initiator","cart-button");s.append("_method","POST");this.$el.classList.add("easystore-spinner");Joomla.request({url:n,method:"POST",data:s,onSuccess:()=>{this.$el.classList.remove("easystore-spinner");this.errorMessage="";this.closeOpenedModalIfAny();this.$dispatch("drawer.open")},onError:e=>{this.$el.classList.remove("easystore-spinner");const t=e.response&&JSON.parse(e.response);this.errorMessage=t?.data?.message??"";alert(this.errorMessage)}})},async openQuickAddModal(e){this.$el.classList.add("easystore-spinner");const t=document.querySelector("#easystore-modal");t.classList.add("active");t.setAttribute("aria-busy","true");const s=await fetch(`${Joomla.getOptions("easystore.base")}/index.php?option=com_easystore&task=product.quickAddModal&id=${e}`);const i=await s.json();const n=t.querySelector(".modal-content");n.innerHTML=i.data;t.setAttribute("aria-busy","false");t.setAttribute("aria-hidden","false");document.body.classList.add("easystore-modal-open");this.$el.classList.remove("easystore-spinner")},sortCombination(e){const t=e.split(";");t.sort((e,t)=>{return e.toLowerCase().localeCompare(t.toLowerCase())});return t.join(";")},getVariant(t,e){const s=`product_variants_${e}`;const i=JSON.parse(this.$refs[s].value);if(i.length===0||!t){return null}return i.find(e=>this.sortCombination(e.combination).toLowerCase()===t.toLowerCase())??false},generateCombination(e){if(!Array.isArray(e)){return}e.sort();return e.join(";")},getCheckedRadios(e){const t=`option_wrapper_${e}`;if(!!this.$refs?.[t]){const s=[...this.$refs[t].querySelectorAll("input[type=radio]:checked")];if(s.length===0){return[]}this.checkedOptions=s.reduce((e,t)=>{e[t.name]=t.value;return e},{});return s.map(e=>e.value)}},getSelectedOptions(e){const t=`option_wrapper_${e}`;if(!!this.$refs?.[t]){const s=[...this.$refs[t].querySelectorAll("select")];this.selectedOptions=s.reduce((e,t)=>{const s=t.getAttribute("name");const i=t.value;e[s]=i;return e},{});return s.map(e=>e.value)}},async handleRadioChange(e,t){const s=this.getVariant(this.generateCombination(this.getCheckedRadios(t)),t);const i=new URLSearchParams(window.location.search);if(e==="single"){i.set("variant",s.id);window.history.replaceState(null,"",`${window.location.pathname}?${i.toString()}`)}const n=e==="single"?"page-content":"quick-modal";await this.fetchProductContentByVariants(s.product_id,s.id,n);Joomla.imageLazyLoading()},async handleSelectChange(e,t){const s=this.getVariant(this.generateCombination(this.getSelectedOptions(t)),t);const i=new URLSearchParams(window.location.search);if(e==="single"){i.set("variant",s.id);window.history.replaceState(null,"",`${window.location.pathname}?${i.toString()}`)}const n=e==="single"?"page-content":"quick-modal";await this.fetchProductContentByVariants(s.product_id,s.id,n);Joomla.imageLazyLoading()},async fetchProductContentByVariants(e,t,s){const i=`${Joomla.getOptions("easystore.base")}/index.php?option=com_easystore&task=product.contentByVariant&product_id=${e}&variant_id=${t}&section_id=${s}`;const n=await fetch(i);const a=await n.json();const o=document.querySelector(a.data.section);o.innerHTML=a.data.content},setInitialActiveSource(){const e=document.querySelector("[easystore-gallery-item].active");if(e){this.activeSource=e.dataset?.src??null;this.setCurrentSelectedIndex();this.watchSelectedImage(this.currentSelectedIndex)}},setCurrentSelectedIndex(){if(!this.activeSource||!this.imageSources.length){this.currentSelectedIndex=0;return}this.currentSelectedIndex=this.imageSources.indexOf(this.activeSource)},get totalImages(){const e=this.getRef("galleryThumbs");if(!e){return 0}const t=[...e.querySelectorAll("[easystore-zoom-thumb]")];return t.length},get imageSources(){const e=this.getRef("galleryThumbs");if(!e){return[]}return[...e.querySelectorAll("[easystore-zoom-thumb]")].map(e=>{return e.dataset?.src}).filter(e=>!!e)},openGalleryPreview(e){this.openPreview=true;this.activeMediaType=e;if(e==="video"){const t=this.getRef("previewVideo");this.playVideo(t)}this.setInitialActiveSource()},isSelected(e){return Number(e)===this.currentSelectedIndex},selectPreviewImage(){this.currentSelectedIndex=Number(this.$el.dataset.index)},selectPreviousImage(){this.currentSelectedIndex=this.currentSelectedIndex-1;if(this.currentSelectedIndex<0){this.currentSelectedIndex=this.totalImages-1}},selectNextImage(){this.currentSelectedIndex=this.currentSelectedIndex+1;if(this.currentSelectedIndex>=this.totalImages){this.currentSelectedIndex=0}},handlePlayPauseOnClick(){if(this.$el.paused){this.$el.play()}else{this.$el.pause()}},playVideo(e){if(!e){return}e.addEventListener("canplay",this.handleVideoPlay)},handleVideoPlay(e){e.target.play()},pauseVideo(e){if(!e){return}e.pause()},watchSelectedImage(e){const t=this.getRef(`thumbItem${e}`);const s=t?.dataset?.src;const i=t?.dataset?.type;const n=this.getRef("previewVideo");const a=this.getRef("previewImage");const o=i==="image"?a:n;this.playState=false;if(!s||!o){return}this.activeMediaType=i;if(i==="video"){n.closest("[easystore-preview-video]").style.display="block";a.style.display="none";o.style.cursor="pointer"}else{this.pauseVideo(n);n.closest("[easystore-preview-video]").style.display="none";a.style.display="block";o.style.cursor="zoom-in"}o.src=s;o.style.transform=`scale(1)`;this.zoomNextLevel=false},watchNextLevelZooming(e){const t=this.getRef("previewImage");if(!t){return}if(e){t.style.transform=`scale(1.2)`;t.style.cursor="zoom-out"}else{t.style.transform=`scale(1)`;t.style.cursor="zoom-in"}},watchPreviewMode(e){const t=this.getRef("zoomGallery");const s=this.getRef("zoomBackdrop");const i=this.getRef("previewVideo");this.setCurrentSelectedIndex();if(!e){i.removeEventListener("canplay",this.handleVideoPlay)}if(!t||!s){return}if(e){t.style.display="block";t.classList.add("gallery-opened");document.body.style.overflow="hidden";s.style.display="block"}else{this.pauseVideo(i);t.style.display="none";document.body.style.overflow="auto";t.classList.remove("gallery-opened");s.style.display="none"}if(!e&&i){i.pause()}}}});Alpine.data("easystoreProductList",()=>{return{init(){this.pagination=Joomla.getOptions("easystore.pagination")},pagination:{}}});Alpine.data("easystorePaynow",()=>({selectedPaymentMethod:"",async generatePaymentSelectors(){const e=await fetch(`${Joomla.getOptions("easystore.base")}/index.php?option=com_easystore&task=order.renderPayments`);const t=await e.json();return t.data},async openModal(){const e=document.querySelector("#easystore-modal");const t=e.querySelector(".modal-content");e.classList.add("active");e.setAttribute("aria-busy","true");const s=await this.generatePaymentSelectors();t.innerHTML=s;e.setAttribute("aria-busy","false");e.setAttribute("aria-hidden","false");document.body.classList.add("easystore-modal-open")},handlePaynow(e=""){window.orderDetails=e;this.$el.classList.add("easystore-spinner");this.openModal();this.$el.classList.remove("easystore-spinner")}}));Alpine.data("easystorePaymentMethods",()=>({selectedPaymentMethod:"",handlePaymentChange(e){this.selectedPaymentMethod=e.target.value},async handlePaymentSubmit(){this.$el.classList.add("easystore-spinner");if(this.selectedPaymentMethod){const t=window.orderDetails;t.payment_method=this.selectedPaymentMethod;const e=new FormData;const s=["id","creation_date","customer_id","customer_email","shipping_address","billing_address","customer_note","payment_status","fulfilment","order_status","is_guest_order","discount_type","discount_value","discount_reason","shipping","payment_method","created","created_by","user"];const i={};s.forEach(e=>{if(t[e]!==undefined){i[e]=t[e]}});i["user"]={email:i["user"].email};e.append("data",JSON.stringify(i));const n=`${Joomla.getOptions("easystore.base")}/index.php?option=com_easystore&task=checkout.orderRepay`;Joomla.request({url:n,method:"POST",data:e,onSuccess:e=>{e=JSON.parse(e);if(e.success&&!e?.data?.pluginError){window.location.href=e.data.navigationUrl}else{Joomla.renderMessages({error:[e.data.pluginError]})}},onError:e=>{Joomla.renderMessages(Joomla.ajaxErrorsMessages(e))},onComplete:()=>{this.$el.classList.remove("easystore-spinner")}})}}}))});class DragImage{isDragging=false;startY=0;startX=0;translateY=0;translateX=0;element=null;clicked=false;isLeaving=false;constructor(e,t=5){this.element=e;this.threshold=t}handleMouseDown(e){this.isDragging=false;this.clicked=true;this.startY=e.clientY-this.element.offsetTop;this.startX=e.clientX-this.element.offsetLeft}handleMouseMove(e){const t=e.clientX-this.startX;const s=e.clientY-this.startY;if(!this.clicked){return}if(Math.abs(t)>this.threshold||Math.abs(s)>this.threshold){this.isDragging=true}if(this.isDragging){this.element.style.transition="none";this.element.style.transform=`translate3d(${t}px, ${s}px, 0)`;this.translateX=t;this.translateY=s}}handleMouseUp(){this.isDragging=false;this.clicked=false}handleMouseEnter(){this.isLeaving=false}handleMouseLeave(){this.isLeaving=true;if(this.isDragging){this.isDragging=false;this.clicked=false;this.element.style.transition="transform 0.3s ese-out";this.element.style.transform=`translate3d(${this.translateX}px, ${this.translateY}px, 0)`}}init(){this.element.addEventListener("mousedown",this.handleMouseDown.bind(this));this.element.addEventListener("mouseup",this.handleMouseUp.bind(this));this.element.addEventListener("mousemove",this.handleMouseMove.bind(this));this.element.addEventListener("mouseleave",this.handleMouseLeave.bind(this));this.element.addEventListener("mouseenter",this.handleMouseEnter.bind(this))}destroy(){this.element.removeEventListener("mousedown",this.handleMouseDown.bind(this));this.element.removeEventListener("mouseup",this.handleMouseUp.bind(this));this.element.removeEventListener("mousemove",this.handleMouseMove.bind(this));this.element.removeEventListener("mouseleave",this.handleMouseLeave.bind(this));this.element.removeEventListener("mouseenter",this.handleMouseEnter.bind(this))}}