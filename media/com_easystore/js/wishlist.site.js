document.addEventListener("alpine:init",()=>{Alpine.data("easyStoreWishlist",()=>({isLoading:false,addToWishList(s){const{productId:t,hasText:i=true,hasIcon:e=true,isWishlist:a=false}=s;if(t){const o=`${Joomla.getOptions("easystore.base")}/index.php?option=com_easystore&task=wishlist.addOrRemoveWishList`;this.hasIcon=e;this.hasText=i;this.wishListIcon=this.$refs.easystoreWishlistIcon;this.wishListText=this.$refs.easystoreWishlistText;this.btn=this.$el;this.action=this.btn.classList.contains("active")?"remove":"add";const n=new FormData;n.append("productId",t);n.append("action",this.action);this.sendRequest(o,n,a);if(a){window.location.reload()}}},async sendRequest(s,t,i=false){const e=new URL(window.location);t.append("return",e.href);this.isLoading=true;try{const a=await Joomla.request({url:s,data:t,method:"POST",promise:true});const o=JSON.parse(a.response);if(!i){this.btn.classList.toggle("active",this.action==="add");if(this.hasIcon)this.wishListIcon.innerHTML=o.data.icon;if(this.hasText)this.wishListText.innerHTML=o.data.text}}catch(s){if(s.status===303){const a=JSON.parse(s.response);this.isLoading=false;if(a.data?.redirect){window.location.href=a.data.redirect;return}}Joomla.renderMessages(Joomla.ajaxErrorsMessages(s))}if(!i){this.isLoading=false}}}))});