function debounce(e,i){let s;return function(...t){clearTimeout(s);s=setTimeout(()=>{e.apply(this,t)},i)}}document.addEventListener("alpine:init",()=>{const r=Alpine.reactive({total:0});Alpine.data("easystore_cart",()=>({async init(){await this.fetchCartData();r.total=this.getTotalNumberOfItems();Alpine.effect(()=>{this.itemCount=r.total;const t=document.querySelector("[easystore-drawer-footer]");if(!t){return}if(this.itemCount===0){t.classList.add("easystore-hide")}else{t.classList.remove("easystore-hide")}})},isLoading:false,loading:false,item:{items:[]},stockMessage:[],itemCount:0,validVideoFormats:["mp4","avi","mov","mkv","flv","wmv","webm"],getTotalNumberOfItems(){if(!this.item.items?.length===0){return 0}return this.item.items.reduce((t,e)=>{return t+Number(e.quantity)},0)},getFileExtension(t=""){return t.split(".").pop()},async fetchCartData(){this.loading=true;const t=await fetch(`${Joomla.getOptions("easystore.base")}/index.php?option=com_easystore&task=cart.getCartData`);const e=await t.json();setTimeout(()=>{this.loading=false},1e3);if(!!e.data){this.item={...this.item,...e.data};this.item.items.forEach(t=>{t.isVideo=this.validVideoFormats.includes(this.getFileExtension(t?.image?.src));t.total_price_with_currency=easystore_formatPrice(t.total_price_with_currency);t.price_with_currency=easystore_formatPrice(t.price_with_currency);t.discounted_price_with_currency=easystore_formatPrice(t.discounted_price_with_currency);if(!t.isVideo&&!t?.image){t.image={src:`${Joomla.getOptions("easystore.base")}/media/com_easystore/images/thumbnail.jpg`}}});this.item.total_with_currency=easystore_formatPrice(this.item.total_with_currency);this.item.sub_total_with_currency=easystore_formatPrice(this.item.sub_total_with_currency);this.item.taxable_amount_with_currency=easystore_formatPrice(this.item.taxable_amount_with_currency)}},decrementQuantity(t){if(this.isLoading)return;this.item.items[t].quantity=Math.max(0,this.item.items[t].quantity-1);this.requestForUpdate(this.item.items)},incrementQuantity(t){if(this.isLoading)return;const e=this.item.items[t];if(e.is_tracking_inventory){if(e.inventory_amount<=0){return}this.item.items[t].quantity=Math.min(e.inventory_amount,Number(this.item.items[t].quantity)+1)}else{this.item.items[t].quantity=Number(this.item.items[t].quantity)+1}this.requestForUpdate(this.item.items)},handleQuantityChange(t,e){let i=Number(t.target.value);if(isNaN(i)){return}i=Math.max(1,i);this.item.items[e].quantity=i;this.requestForUpdate(this.item.items)},removeCartItem(t,e="cart-page"){if(this.item.items.length>0){this.item.items.splice(t,1)}this.requestForUpdate(this.item.items,e)},toCurrency(t){return t.toLocaleString()},requestForUpdate:debounce(function(t,i){this.isLoading=true;const e=new FormData;const s=t.map(t=>{return{product_id:t.product_id,sku_id:t.sku_id??null,quantity:t.quantity??0,id:t.id??null}}).filter(t=>t.quantity>0);e.append("items",JSON.stringify(s));e.append("initiator",i);e.append("_method","POST");const a=`${Joomla.getOptions("easystore.base")}/index.php?option=com_easystore&task=cart.addToCart`;Joomla.request({url:a,method:"POST",data:e,onSuccess:async t=>{t=JSON.parse(t);if(!!t.data){await this.fetchCartData();r.total=this.getTotalNumberOfItems()}if(this.item.items?.length===0){if(i==="mini-cart"){const e=`${Joomla.getOptions("easystore.base")}${t.data.link}`;window.location.replace(e).reload()}window.location.reload()}},onComplete:()=>{setTimeout(()=>{this.isLoading=false},1e3)},onError:t=>{const e=t.response&&JSON.parse(t.response);errorMessage=e?.data?.message??"";alert(errorMessage)}})},500)}))});